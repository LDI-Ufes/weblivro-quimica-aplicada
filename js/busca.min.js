function toSearch(){document.getElementById("barra-de-busca").firstElementChild.firstElementChild.children[1].focus(),window.scroll(0,-100),btnPesquisa.classList.add("ativo")}const btnPesquisa=document.getElementById("btn-pesquisa");btnPesquisa.addEventListener("click",e=>{e.preventDefault(),toSearch(),toSearch&&setTimeout(()=>{btnPesquisa.hidden=!0},500)}),setTimeout(()=>{let e=document.getElementById("searchText");e.addEventListener("keydown",()=>{0!==e.value.length?btnPesquisa.hidden="true":btnPesquisa.hidden="false"})},1e3);let BOOK=[];const loadTexts=async()=>{let e,t=[];try{const t=await fetch("./capitulos.json");e=await t.json()}catch(e){return void console.error({message:"Erro ao carregar <capitulos.json>",error:e})}for(chapter of e)try{const e=await fetch(chapter.arquivo),a=await e.text();t.push({title:chapter.titulo,subtitle:chapter.subtitulo,file:chapter.arquivo,text:removeLineBreaks(await stripHTML(a))})}catch(e){console.error({message:"Erro ao carregar os capítulos do livro.",error:e})}BOOK=t},cleanTexts=async()=>{BOOK.forEach(async(e,t)=>{e.cleanText||(BOOK[t].cleanText=await clean(e.text))})},clearResult=e=>e.split(" ").slice(1,-1).join(" "),replaceBrChars=async e=>e.replace(/[áàãâä]/giu,"a").replace(/[éèêë]/giu,"e").replace(/[íìîï]/giu,"i").replace(/[óòõôö]/giu,"o").replace(/[úùûü]/giu,"u").replace(/[ç]/giu,"c"),removeLineBreaks=e=>e.replace(/\n+/giu,"\n"),stripHTML=async e=>{if(!e&&"string"!=typeof e)return"";const t=e.indexOf("<article"),a=e.indexOf("</article>");if(-1===t&&-1===a)return"";const r=document.createElement("html");return r.innerHTML=e.substring(t,a),r.innerText},clean=async e=>{let t=e.toLowerCase();return await replaceBrChars(t)},queryRegex=e=>new RegExp(e,"gi"),search=async e=>{let t=queryRegex(await clean(e)),a=0;for(chapter of BOOK){const r=[];let s=null;for(;s=t.exec(chapter.cleanText);){const t=s.index;r.push(t),1===r.length&&addSection(chapter.title),addResult(t,e,chapter.text),a++}}updateNumberOfResults(a)},showSearchUI=()=>{isLoading.style.display="none",searchArea.style.display="block",setSearchWords("...")},addResult=(e,t,a)=>{const r=chapter.text.substring(e,e+t.length),s=chapter.text.substring(e-55,e),n=chapter.text.substring(e+t.length,e+t.length+55),c=clearResult(`${s}<strong>${r}</strong>${n}[...]`),l=`${chapter.file}?preambule=${chapter.text.substring(e-20,e-1)}&word=${t}`,o=document.createElement("li");o.innerHTML=`\n    <a title="Ir para o trecho do capítulo" href="${l}">[...] ${c} [...]</a>\n  `,document.getElementById("resultados").appendChild(o)},addSection=e=>{const t=document.createElement("h2"),a=document.createTextNode(e);t.appendChild(a),document.getElementById("resultados").appendChild(t)},updateNumberOfResults=e=>{if(document.getElementById("search-header").style.display="flex",document.getElementById("n-resultados").innerText=e,0==e){let e=document.getElementById("noresult"),t=document.getElementById("chave"),a=document.getElementById("barra-de-busca").firstElementChild.firstElementChild.children[1],r=e.querySelector("a");t.innerText=a.value,e.style.display="block",document.getElementById("resultados").appendChild(e),r.addEventListener("click",e=>{e.preventDefault(),a.focus(),window.scroll(0,-100),r.classList.add("ativo"),setTimeout(()=>{r.hidden=!0},500)})}},setSearchWords=e=>{document.getElementById("termo").innerHTML=e},cleanResults=()=>{let e=document.getElementById("resultados");for(;e.firstChild;)e.removeChild(e.firstChild)},setParam=e=>{let t=new URLSearchParams(window.location.search);t.set("query",e),history.pushState(null,`Pesquisa: ${e}`,`?query=${t.get("query")}`)},getParam=()=>{return new URLSearchParams(window.location.search).get("query")},checkParamSearch=async()=>{const e=new URLSearchParams(window.location.search).get("query");e&&(document.getElementById("searchText").value=e,cleanResults(),setSearchWords(e),await search(e))},resultsMain=async()=>{await loadTexts(),await cleanTexts(),setupEvents(),isLoading.style.display="none",searchArea.style.display="block",setSearchWords("..."),await checkParamSearch()};document.addEventListener("DOMContentLoaded",async()=>{await resultsMain()});let semResultado=document.getElementById("noresult"),botaoResultado=semResultado.querySelector("#btn-pesquisa");setTimeout(()=>{document.getElementById("searchText").addEventListener("keydown",()=>{botaoResultado.hidden="true"})},1e3);